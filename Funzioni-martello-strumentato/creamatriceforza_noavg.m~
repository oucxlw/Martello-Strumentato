function [Matrice, pos] = creamatriceforza_noavg (Segnale, picchi,n_picchi, L_pre, L_coda, filt_doppi, fs)
% Function che trova i picchi del vettore Forze, usando come Input: 
%I1) il segnale Forze; 
%I2) il segnale Accelerazioni;
%I3) soglia dei picchi (soglia);
%I4) sample da saltare una volta superata la soglia (delay);
%I5) punto di inizio della ricerca dei picchi (inizio);
%I6) punto di fine della ricerca dei picchi (fine);
%I7) lunghezza della parte prima del picco (L_pre);
%I8) lunghezza della parte dopo del picco (L_coda);
%I9) se filt_doppi=1 i colpi vengono filtrati eliminando i doppi colpi (filt_doppi);
%I10) la frequenza di campionamento in Hz;
%restituendo come Output: 
%O1) il numero di picchi selezionati (picchi_sel); 
%O2) la matrice delle singole forze (F) sistemate in colonne;
%O3) la matrice delle singole accelerazioni (A) sistemate in colonne. 

x=Segnale;

%<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
% Definizione delle matrici (selezione dei segnali)
%<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
Matrice=[];
pos=[];
for j = 1: n_picchi
    in  = round(picchi(j) - L_pre);
    out = round(picchi(j) + L_coda);

    %<<<<<<<<<<<<<<<<<<<<<
    % Media Mobile
    %<<<<<<<<<<<<<<<<<<<<<
    x_temp = x(in:out);-x(in); 

    %<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
    % Filtraggio per doppio colpo
    %<<<<<<<<<<<<<<<<<<<<<<<<<<<<<    
    if filt_doppi==1
        n_colpi = findpeaks(x_temp,fs,'MinPeakDistance',0.002,'Threshold',0,'MinPeakHeight',5);
    else
        n_colpi = 1;  % i colpi non vengono filtrati
    end

    %<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
    % Filtraggio per intensità del colpo
    %<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
    if  length(n_colpi) == 1 %&& max(x_temp)>= 30 && (max(x_temp) <=50) 
        Matrice = [Matrice, x_temp];
        pos=[pos,picchi(j)];
    end

j = j+1;
end

end